## å¤šè¿›ç¨‹ vs å¤šçº¿ç¨‹
>å…ˆæ€»ç»“
- I/O å¯†é›†åž‹ï¼ˆä¸‹è½½ç½‘é¡µã€æ–‡ä»¶æ“ä½œï¼‰ â†’ å¤šçº¿ç¨‹æ›´å¥½
- CPU å¯†é›†åž‹ï¼ˆçŸ©é˜µè®¡ç®—ã€æ•°æ®åŽ‹ç¼©ï¼‰ â†’ å¤šè¿›ç¨‹æ›´å¥½

----

### 1 å¤šçº¿ç¨‹ï¼ˆThreadingï¼‰

- **å…±äº«å†…å­˜**ï¼šçº¿ç¨‹å±žäºŽåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå¤©ç„¶å…±äº«å†…å­˜ç©ºé—´ï¼Œæ•°æ®äº¤æ¢å¿«ï¼Œä½†éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼ˆåŠ é”ã€åŒæ­¥ç­‰ï¼‰
- **è½»é‡çº§**ï¼šåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ¯”è¿›ç¨‹å¼€é”€å°ï¼Œé€‚åˆ I/O å¯†é›†åž‹ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ï¼‰
- **å— GIL é™åˆ¶ï¼ˆCPythonï¼‰**ï¼šå…¨å±€è§£é‡Šå™¨é”ä½¿å¾—åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ Python å­—èŠ‚ç ï¼Œå› æ­¤åœ¨ CPU å¯†é›†åž‹ä»»åŠ¡ä¸‹ï¼Œå¤šçº¿ç¨‹åŠ é€Ÿæœ‰é™

### 2 å¤šè¿›ç¨‹ï¼ˆMultiprocessingï¼‰
- **ç‹¬ç«‹å†…å­˜**ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œæ•°æ®éœ€è¦é€šè¿‡è¿›ç¨‹é—´é€šä¿¡ï¼ˆå¦‚é˜Ÿåˆ—ã€ç®¡é“ï¼‰ã€‚
- **é‡é‡çº§**ï¼šåˆ›å»ºå’Œé”€æ¯è¿›ç¨‹æ¯”çº¿ç¨‹å¼€é”€å¤§ã€‚
- **çœŸæ­£å¹¶è¡Œ**ï¼šä¸å— GIL å½±å“ï¼Œé€‚åˆ CPU å¯†é›†åž‹ï¼ˆå¦‚è®¡ç®—ã€åŠ å¯†ã€å›¾åƒå¤„ç†ï¼‰ã€‚



### 3 ä½¿ç”¨ concurrent.futures

concurrent.futures æä¾›ç»Ÿä¸€çš„æŽ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ `çº¿ç¨‹æ±  (ThreadPoolExecutor)` æˆ– `è¿›ç¨‹æ±  (ProcessPoolExecutor)`

#### 3.1 å¤šçº¿ç¨‹ç¤ºä¾‹ï¼ˆI/O å¯†é›†åž‹ï¼šçˆ¬å–ç½‘é¡µï¼‰
ðŸ‘‰ é€‚åˆ I/O å¯†é›†åž‹ä»»åŠ¡ï¼Œå¤šä¸ªè¯·æ±‚èƒ½å¹¶å‘æ‰§è¡Œã€‚

>Example
```py
import concurrent.futures
import time
import requests

URLS = [
    "https://www.python.org",
    "https://www.openai.com",
    "https://docs.python.org/3/library/concurrent.futures.html"
]

def fetch(url):
    response = requests.get(url)
    return f"{url} -> {len(response.content)} bytes"

start = time.time()
with concurrent.futures.ThreadPoolExecutor(max_workers=3) as executor:
    results = executor.map(fetch, URLS)
    for r in results:
        print(r)

print(f"è€—æ—¶: {time.time() - start:.2f}s")
```


#### 3.2 å¤šè¿›ç¨‹ç¤ºä¾‹ï¼ˆCPU å¯†é›†åž‹ï¼šè®¡ç®—é˜¶ä¹˜ï¼‰

>Example
```py
import concurrent.futures
import time
import math

NUMS = [100000, 120000, 150000, 180000]

def intensive(n):
    return sum(math.factorial(i % 100) for i in range(n))

start = time.time()
with concurrent.futures.ProcessPoolExecutor(max_workers=4) as executor:
    results = executor.map(intensive, NUMS)
    for r in results:
        print("ç»“æžœ:", r)

print(f"è€—æ—¶: {time.time() - start:.2f}s")
```