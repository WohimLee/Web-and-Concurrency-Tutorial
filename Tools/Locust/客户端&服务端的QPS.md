QPS（Queries Per Second，查询每秒）通常是 **服务端** 来计算的，但在压力测试和性能测试中，**客户端** 和 **服务端** 都可以有各自的计算方式。

### 1. **服务端计算 QPS**：

* **服务端** 通常会根据实际接收到的请求数量来计算 QPS。服务器会统计在一定时间内（例如每秒、每分钟）处理的请求数。
* 这对于评估服务端的负载和性能非常重要，尤其是在压力测试时，服务端计算 QPS 可以帮助你了解在不同负载下，服务器的处理能力和响应能力。

#### 服务端计算 QPS 的方式：

* 服务器会在请求到达时，记录时间戳。
* 在一定时间间隔（如 1 秒）内，统计接收到的请求数量。
* 计算公式为：
  [
  QPS = \frac{\text{单位时间内请求总数}}{\text{时间}}
  ]

**例如**：如果在 1 秒内服务器接收到 500 个请求，那么服务端的 QPS 就是 500。

### 2. **客户端计算 QPS（压力测试工具）**：

在使用 **Locust**、**JMeter** 或其他压力测试工具时，QPS 是客户端通过模拟请求来控制的。在这种情况下，客户端设置了每秒发送的请求数量，测试工具会模拟多个用户同时发起请求，并在客户端计算实际的请求发送速度。

* **Locust**：用户通过设置 `-u`（并发用户数）和 `-r`（每秒用户增长数）来模拟目标 QPS。在运行时，Locust 会记录每秒发送的请求数，并计算最终的 QPS。
* **JMeter**：通过配置线程数（虚拟用户）和请求速率来控制每秒的请求数，JMeter 会在测试过程中记录 QPS 和其他指标。

#### 客户端计算 QPS 的方式：

* 客户端测试工具会记录它所发送的请求数量，并计算在某个时间段内的平均请求频率。
* 客户端 QPS 是通过模拟请求发送的数量和速率来估算的。

**例如**：如果测试工具配置为每秒发送 100 个请求，并且运行了 5 秒，那么客户端模拟的 QPS 就是 100（每秒发送的请求数）。

### 3. **服务端与客户端的关系**：

* **客户端计算 QPS**：客户端（测试工具）会根据预设的并发用户数和请求速率来模拟 QPS。在负载测试中，客户端的 QPS 是我们想要验证的目标速率。
* **服务端计算 QPS**：服务端会记录它实际处理的请求数，这通常是用来验证服务器是否能够承受来自客户端的负载，判断服务器的性能和稳定性。

### 总结：

* **客户端**计算 QPS主要用于模拟请求负载和测试的目的，通常由压力测试工具（如 Locust）来执行，设定并发用户和请求速率。
* **服务端**计算 QPS则是实际的系统性能指标，用于衡量服务端处理请求的能力和效率。在服务端中，QPS 反映了服务器在特定时间内处理的请求数量。

在压力测试中，两者是相辅相成的，客户端通过模拟负载来产生 QPS，服务端则通过计算实际接收到的请求数来反映其处理能力。
